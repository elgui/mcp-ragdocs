<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Descriptions Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#64748b',
                        danger: '#dc2626',
                        success: '#16a34a',
                        warning: '#d97706'
                    }
                }
            }
        }
    </script>
    <style>
        .btn-primary {
            @apply bg-primary text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-colors;
        }
        .btn-secondary {
            @apply bg-secondary text-white px-4 py-2 rounded-md hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-opacity-50 transition-colors;
        }
        .btn-danger {
            @apply bg-danger text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition-colors;
        }
        .loading {
            @apply opacity-75 cursor-not-allowed;
        }
        .spinner {
            @apply animate-spin inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-primary"><i class="fas fa-file-code"></i> File Descriptions Tool</h1>
            <p class="text-slate-600 mt-2">Generate concise descriptions for source code files</p>
        </header>
        
        <main class="space-y-6">
            <section class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-search text-primary"></i> Search Query
                </h2>
                <div class="flex flex-col md:flex-row gap-2 mb-4">
                    <input type="text" id="searchQuery" placeholder="Enter search query to find relevant files" 
                           class="flex-1 px-4 py-2 border border-slate-200 rounded-md focus:border-primary focus:outline-none">
                    <input type="number" id="limitInput" placeholder="Limit" value="10" min="1" max="50"
                           class="w-24 px-4 py-2 border border-slate-200 rounded-md focus:border-primary focus:outline-none">
                    <button id="searchBtn" class="btn-primary">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
                <div id="searchStatus" class="text-sm text-slate-500 mt-2 hidden">
                    <i class="fas fa-spinner fa-spin"></i> Searching...
                </div>
            </section>

            <section id="resultsSection" class="bg-white rounded-lg shadow p-6 hidden">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-file-alt text-primary"></i> File Descriptions
                    <span id="resultCount" class="text-sm font-normal text-slate-500"></span>
                </h2>
                <div id="resultsContainer" class="space-y-4">
                    <!-- Results will be inserted here -->
                </div>
                <div id="noResults" class="p-8 text-center text-slate-500 hidden">
                    No files found matching your query.
                </div>
            </section>

            <section id="rawResponseSection" class="bg-white rounded-lg shadow p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold flex items-center gap-2">
                        <i class="fas fa-code text-primary"></i> Raw Response
                    </h2>
                    <button id="toggleRawBtn" class="text-sm text-slate-500 hover:text-primary">
                        <i class="fas fa-chevron-down"></i> <span>Show</span>
                    </button>
                </div>
                <div id="rawResponseContainer" class="hidden">
                    <pre id="rawResponse" class="bg-slate-100 p-4 rounded-md text-sm overflow-x-auto"></pre>
                </div>
            </section>
        </main>

        <footer class="mt-8 text-center text-slate-500 text-sm">
            <p>MCP RAG Docs - File Descriptions Tool</p>
            <p class="mt-1">
                <a href="/" class="text-primary hover:underline">
                    <i class="fas fa-home"></i> Back to Home
                </a>
            </p>
        </footer>
    </div>

    <script>
        const API_BASE_URL = '';
        const searchBtn = document.getElementById('searchBtn');
        const searchQuery = document.getElementById('searchQuery');
        const limitInput = document.getElementById('limitInput');
        const searchStatus = document.getElementById('searchStatus');
        const resultsSection = document.getElementById('resultsSection');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultCount = document.getElementById('resultCount');
        const noResults = document.getElementById('noResults');
        const rawResponseSection = document.getElementById('rawResponseSection');
        const rawResponseContainer = document.getElementById('rawResponseContainer');
        const rawResponse = document.getElementById('rawResponse');
        const toggleRawBtn = document.getElementById('toggleRawBtn');

        // Toggle raw response
        toggleRawBtn.addEventListener('click', () => {
            const isHidden = rawResponseContainer.classList.contains('hidden');
            rawResponseContainer.classList.toggle('hidden', !isHidden);
            toggleRawBtn.querySelector('span').textContent = isHidden ? 'Hide' : 'Show';
            toggleRawBtn.querySelector('i').className = isHidden ? 'fas fa-chevron-up' : 'fas fa-chevron-down';
        });

        // Set button loading state
        function setButtonLoading(button, isLoading, loadingText) {
            if (isLoading) {
                button.disabled = true;
                button.classList.add('loading');
                button.innerHTML = `<span class="spinner"></span> ${loadingText || 'Loading...'}`;
            } else {
                button.disabled = false;
                button.classList.remove('loading');
                button.innerHTML = `<i class="fas fa-search"></i> Search`;
            }
        }

        // Search for file descriptions
        searchBtn.addEventListener('click', async () => {
            const query = searchQuery.value.trim();
            const limit = parseInt(limitInput.value) || 10;
            
            if (!query) {
                alert('Please enter a search query');
                searchQuery.focus();
                return;
            }
            
            // Show loading state
            setButtonLoading(searchBtn, true, 'Searching...');
            searchStatus.classList.remove('hidden');
            resultsSection.classList.add('hidden');
            rawResponseSection.classList.add('hidden');
            
            try {
                const response = await fetch(`${API_BASE_URL}/file-descriptions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query, limit })
                });
                
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Display raw response
                rawResponse.textContent = JSON.stringify(data, null, 2);
                rawResponseSection.classList.remove('hidden');
                
                // Display results
                displayResults(data);
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Error: ${error.message}`);
                noResults.textContent = `Error: ${error.message}`;
                noResults.classList.remove('hidden');
                resultsContainer.innerHTML = '';
                resultCount.textContent = '';
                resultsSection.classList.remove('hidden');
            } finally {
                setButtonLoading(searchBtn, false);
                searchStatus.classList.add('hidden');
            }
        });

        // Display results
        function displayResults(data) {
            resultsContainer.innerHTML = '';
            
            if (!data.files || data.files.length === 0) {
                noResults.classList.remove('hidden');
                resultCount.textContent = '(0 files)';
            } else {
                noResults.classList.add('hidden');
                resultCount.textContent = `(${data.files.length} files)`;
                
                data.files.forEach(file => {
                    const fileCard = document.createElement('div');
                    fileCard.className = 'border border-slate-200 rounded-md p-4 hover:bg-slate-50';
                    
                    fileCard.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold text-primary">
                                <i class="fas fa-file-code mr-2"></i>${file.filePath.split('/').pop()}
                            </h3>
                            <span class="text-xs bg-slate-100 text-slate-700 px-2 py-1 rounded-full">${file.fileType}</span>
                        </div>
                        <div class="text-xs text-slate-500 mt-1">${file.filePath}</div>
                        <div class="mt-2 text-sm">${file.description}</div>
                        <div class="mt-2 text-sm text-slate-700">
                            <strong>Main functionality:</strong> ${file.mainFunctionality}
                        </div>
                    `;
                    
                    resultsContainer.appendChild(fileCard);
                });
            }
            
            resultsSection.classList.remove('hidden');
        }

        // Handle Enter key in search input
        searchQuery.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });
    </script>
</body>
</html>
